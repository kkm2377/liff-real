<!DOCTYPE html>
<html lang="jp" dir="ltr">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>liff-Real</title>
        <link rel="stylesheet" href="style.css">
        <script src="https://static.line-scdn.net/liff/edge/2/sdk.js"></script>
        <script type="text/javascript">
            /**
            * Initialize LIFF
            * @param {string} myLiffId The LIFF app ID of the selected element
            */
            document.addEventListener("DOMContentLoaded", () => {
                liff
                    .init({
                        liffId: "1655828362-KLxYgqxg"
                    })
                    .then(() => {
                        document.getElementById('go').addEventListener('click', () => {
                            document.getElementById('log').value =
                              'â—‹è¨€èªè¨­å®š\n' +
                              'liff.getLanguage()=' + liff.getLanguage() + '\n' +
                              'â—‹LIFF SDKã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³\n' +
                              'liff.getVersion()=' + liff.getVersion() + '\n' +
                              'â—‹LIFF LINEã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³\n' +
                              'liff.getLineVersion()=' + liff.getLineVersion() + '\n' +
                              'â—‹LINEå†…ãƒ–ãƒ©ã‚¦ã‚¶ã§å‹•ä½œã•ã›ã¦ã„ã‚‹ã‹ã©ã†ã‹\n' +
                              'liff.isInClient()=' + liff.isInClient() + '\n' +
                              'â—‹ãƒ­ã‚°ã‚¤ãƒ³ã—ã¦ã„ã‚‹ã‹ã©ã†ã‹\n' +
                              'liff.isLoggedIn()=' + liff.isLoggedIn() + '\n' +
                              'â—‹OS\n' +
                              'liff.getOS()=' + liff.getOS() + '\n' +
                              'â—‹ã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³\n' +
                              'liff.getAccessToken()=' + liff.getAccessToken() + '\n' +
                              'â—‹Get ID Token\n' +
                              'liff.getIDToken()=' + liff.getIDToken() + '\n' +
                              'â—‹ç”»é¢ï¼ˆ1å¯¾1ã®ãƒãƒ£ãƒƒãƒˆã€ã‚°ãƒ«ãƒ¼ãƒ—ã€ã¾ãŸã¯ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ï¼‰ã‚’ä¸€æ„ã«è­˜åˆ¥ã™ã‚‹å€¤\n' +
                              'liff.getContext()=' + JSON.stringify(liff.getContext()) + '\n' +
                              'â—‹ãƒ¦ãƒ¼ã‚¶ãƒ¼åç­‰\n' +
                              'liff.getDecodedIDToken()=' + JSON.stringify(liff.getDecodedIDToken()) + '\n\n\n' +
                              'â—‹ ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«\n' +
                              'liff.getProfile()=' + JSON.stringify(liff.getProfile()) + '\n' +
                              'â—‹ Create URL\n' +
                              'liff.permanentLink.createUrl()=' + liff.permanentLink.createUrl() + '\n' ;
                        });
                        document.getElementById('popup').addEventListener('click', () => {
                            liff.openWindow({
                                url: "https://liff.line-beta.me/1655828362-KLxYgqxg",
                                external: true
                            });
                        });

                        document.getElementById('home').addEventListener('click', () => {
                            liff.addToHomeScreen({
                                name: "LINE",
                                iconUrl: "https://obs-beta.line-scdn.net/0hi2dU1wubNh1ZLCCnLGVJSntxPX9qTigWexgyezx-HU0oSQRLLjEmH3RQDVY_TwQ3LjUyJidHHkkyYAMgZiscAyB8DSw8dDc/f256x256",
                                state: "https://liff.line-beta.me/1651833066-0omDANP2"
                            });
                        });

                        document.getElementById('message').addEventListener('click', () => {

                        });
                    
                        document.getElementById('qrcode').addEventListener('click', () => {
                            if (liff.scanCode) {
                                liff.scanCode().then(result => {
                                    result = { value: '' }
                                });
                            }
                        });

                        document.getElementById('flex').addEventListener('click', () => {
                            liff.sendMessages([{
                                "type": "flex",
                                "altText": "This is a Flex Message",
                                "contents":
                            {
                                "type": "bubble",
                                "header": {
                                  "type": "box",
                                  "layout": "vertical",
                                  "contents": [
                                    {
                                      "type": "text",
                                      "text": "LINE Corp",
                                      "color": "#FFFFFF",
                                      "weight": "bold"
                                    }
                                  ]
                                },
                                "hero": {
                                  "type": "image",
                                  "url": "https://obs-beta.line-scdn.net/0hi2dU1wubNh1ZLCCnLGVJSntxPX9qTigWexgyezx-HU0oSQRLLjEmH3RQDVY_TwQ3LjUyJidHHkkyYAMgZiscAyB8DSw8dDc/f256x256",
                                  "size": "xl"
                                },
                                "body": {
                                  "type": "box",
                                  "layout": "vertical",
                                  "contents": [
                                    {
                                      "type": "text",
                                      "text": "hogehoge",
                                      "size": "xl",
                                      "weight": "bold",
                                      "align": "center"
                                    },
                                    {
                                      "type": "text",
                                      "text": "LINE Corp Developer",
                                      "align": "center"
                                    },
                                    {
                                      "type": "separator",
                                      "margin": "md"
                                    },
                                    {
                                      "type": "box",
                                      "layout": "vertical",
                                      "contents": [
                                        {
                                          "type": "button",
                                          "action": {
                                            "type": "uri",
                                            "label": "LINE Corp Official Site",
                                            "uri": "http://linecorp.com/"
                                          },
                                          "style": "link"
                                        },
                                        {
                                          "type": "button",
                                          "action": {
                                            "type": "uri",
                                            "label": "Sign in as a User",
                                            "uri": "https://android-liff-test.herokuapp.com/index.html"
                                          },
                                          "style": "link"
                                        },
                                        {
                                          "type": "button",
                                          "action": {
                                            "type": "uri",
                                            "label": "Ask me on the Call",
                                            "uri": "https://line.me/R/call/81/08012345678"
                                          },
                                          "style": "link"
                                        }
                                      ],
                                      "paddingTop": "10px"
                                    }
                                  ]
                                },
                                "styles": {
                                  "header": {
                                    "backgroundColor": "#00B900"
                                  }
                                }
                            }
                              }]);
                        });
                    })
                    .catch((err) => {
                        document.getElementById("liffAppContent").classList.add('hidden');
                        document.getElementById("liffInitErrorMessage").classList.remove('hidden');
                        console.log(err.code, err.message);
                    })
            })
            document.addEventListener("DOMContentLoaded", function() {
                var video = document.createElement("video");
                var canvasElement = document.getElementById("canvas");
                var canvas = canvasElement.getContext("2d");
                var loadingMessage = document.getElementById("loadingMessage");
                var outputContainer = document.getElementById("output");
                var outputMessage = document.getElementById("outputMessage");
                var outputData = document.getElementById("outputData");
                function drawLine(begin, end, color) {
                    canvas.beginPath();
                    canvas.moveTo(begin.x, begin.y);
                    canvas.lineTo(end.x, end.y);
                    canvas.lineWidth = 4;
                    canvas.strokeStyle = color;
                    canvas.stroke();
                }
                // ì¹´ë©”ë¼ ì‚¬ìš©ì‹œ
                navigator.mediaDevices.getUserMedia({ video: { facingMode: "environment" } }).then(function(stream) {
                    video.srcObject = stream;
                    video.setAttribute("playsinline", true);      // iOS ì‚¬ìš©ì‹œ ì „ì²´ í™”ë©´ì„ ì‚¬ìš©í•˜ì§€ ì•ŠìŒì„ ì „ë‹¬
                    video.play();
                    requestAnimationFrame(tick);
                });
                function tick() {
                    loadingMessage.innerText = "âŒ› ìŠ¤ìº” ê¸°ëŠ¥ì„ í™œì„±í™” ì¤‘ì…ë‹ˆë‹¤."
                    if(video.readyState === video.HAVE_ENOUGH_DATA) {
                        loadingMessage.hidden = true;
                        canvasElement.hidden = false;
                        outputContainer.hidden = false;
                        // ì½ì–´ë“¤ì´ëŠ” ë¹„ë””ì˜¤ í™”ë©´ì˜ í¬ê¸°
                        canvasElement.height = video.videoHeight;
                        canvasElement.width = video.videoWidth;
                        canvas.drawImage(video, 0, 0, canvasElement.width, canvasElement.height);
                        var imageData = canvas.getImageData(0, 0, canvasElement.width, canvasElement.height);
                        var code = jsQR(imageData.data, imageData.width, imageData.height, {
                            inversionAttempts : "dontInvert",
                        });
                        // QRì½”ë“œ ì¸ì‹ì— ì„±ê³µí•œ ê²½ìš°
                        if(code) {
                            // ì¸ì‹í•œ QRì½”ë“œì˜ ì˜ì—­ì„ ê°ì‹¸ëŠ” ì‚¬ìš©ìì—ê²Œ ë³´ì—¬ì§€ëŠ” í…Œë‘ë¦¬ ìƒì„±
                            drawLine(code.location.topLeftCorner, code.location.topRightCorner, "#FF0000");
                            drawLine(code.location.topRightCorner, code.location.bottomRightCorner, "#FF0000");
                            drawLine(code.location.bottomRightCorner, code.location.bottomLeftCorner, "#FF0000");
                            drawLine(code.location.bottomLeftCorner, code.location.topLeftCorner, "#FF0000");
                            outputMessage.hidden = true;
                            outputData.parentElement.hidden = false;
                            // QRì½”ë“œ ë©”ì‹œì§€ ì¶œë ¥
                            outputData.innerHTML = code.data;
                            // returnì„ ì¨ì„œ í•¨ìˆ˜ë¥¼ ë¹ ì ¸ë‚˜ê°€ë©´ QRì½”ë“œ í”„ë¡œê·¸ë¨ì´ ì¢…ë£Œëœë‹¤.
                            // return;
                        }
                        // QRì½”ë“œ ì¸ì‹ì— ì‹¤íŒ¨í•œ ê²½ìš° 
                        else {
                            outputMessage.hidden = false;
                            outputData.parentElement.hidden = true;
                        }
                    }
                    requestAnimationFrame(tick);
                }
            });
        </script>
        <style>
            body{background:black}
        </style>
</head>
<body>
    <main>
        <div id="test">
            <h1>QR ì½”ë“œ ë¦¬ë”</h1>
            <div id="output">
                <div id="outputMessage">
                    QRì½”ë“œë¥¼ ì¹´ë©”ë¼ì— ë…¸ì¶œì‹œì¼œ ì£¼ì„¸ìš”
                </div>
                <div id="outputLayer" hidden>
                    <span id="outputData"></span>
                </div>
            </div>
        </div>
        <div>&nbsp;</div>
        <div>
            <h1>ìŠ¤ìº”</h1>
            <div id="frame">
                <div id="loadingMessage">
                    ğŸ¥ ë¹„ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ì— ì•¡ì„¸ìŠ¤ í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤<br/>ì›¹ìº ì´ í™œì„±í™”ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ì‹­ì‹œì˜¤
                </div>
                <canvas id="canvas"></canvas>
            </div>
        </div>
    </main>
      <div>
      <h2>HTML Forms to https://httpbin.org/post with no parameter</h2>
      <form action="https://httpbin.org/post" method="post">
          <input type="submit" value="Submit">
      </form>
      <h3>ç’°å¢ƒã‚„ãƒˆãƒ¼ã‚¯ãƒ«ãƒ¼ãƒ ã®æƒ…å ±ã‚’å–å¾—</h3>
      <input type="button" id="home" value="home"/>
      <input type="button" id="go" value="å®Ÿè¡Œ"/>
      <input type="button" id="popup" value="popup"/>
      <input type="button" id="message" value="Message"/>
      <input type="button" id="flex" value="flex"/>
      <input type="button" id="qrcode" value="QRcode"/>
      <a href="https://android-liff-test.herokuapp.com/index.html" target="_blank">IAB</a>
      <textarea id="log" style="width:96%;height:350px;"></textarea>
    </div>
  </body>
</html>
